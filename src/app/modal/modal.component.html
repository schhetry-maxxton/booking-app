<div class="modal-header">
  <!-- <h4 class="modal-title">Booking Details</h4> -->
  <h5 class="modal-title" id="bookingModalLabel" style=" font-size: 1.5rem;">Booking Details</h5>
  <button type="button" class="close" aria-label="Close"  (click)="refreshPage()">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<div class="modal-body">
  <ng-container [ngSwitch]="currentStep">
    <div *ngSwitchCase="1">
      <!-- Booking Form Content -->
      <form [formGroup]="bookingForm">
        <!-- Booking Form Fields -->
        <div class="modal-step-content">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Reservation ID</label>
            <p class="form-text">{{ bookingForm.get('reservationId')?.value }}</p>
          </div>
          <div class="form-group">
            <label class="form-label">Room no.</label>
            <p class="form-text">{{ bookingForm.get('roomNo')?.value }}</p>
          </div>
          <div class="form-group">
            <label class="form-label">Arrival date</label>
            <p class="form-text">{{ bookingForm.get('stayDateFrom')?.value | date }}</p>
          </div>
          <div class="form-group">
            <label class="form-label">Departure date</label>
            <p class="form-text">{{ bookingForm.get('stayDateTo')?.value | date }}</p>
          </div>
          <div class="form-group">
            <label class="form-label">Number of nights</label>
            <p class="form-text">{{ bookingForm.get('numberOfDays')?.value }}</p>
          </div>
          <div class="form-group">
            <label class="form-label">Reservation date</label>
            <p class="form-text">{{ bookingForm.get('reservationDate')?.value | date }}</p>
          </div>
          <div class="form-group">
            <label class="form-label">Guests</label>
            <input type="number" id="totalNumberOfGuests" class="form-control" formControlName="totalNumberOfGuests">
            <div *ngIf="bookingForm.get('totalNumberOfGuests')?.invalid && bookingForm.get('totalNumberOfGuests')?.touched">
              <small class="text-danger" *ngIf="bookingForm.get('totalNumberOfGuests')?.errors?.['required']">This field is required.</small>
              <small class="text-danger" *ngIf="bookingForm.get('totalNumberOfGuests')?.errors?.['min']">Must be at least 1 guest.</small>
              <small class="text-danger" *ngIf="bookingForm.get('totalNumberOfGuests')?.errors?.['max']">
                Cannot exceed {{ maxGuestCapacity }} guests.
              </small>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Price per person</label>
            <p class="form-text">₹{{ bookingForm.get('pricePerDayPerPerson')?.value }}</p>
          </div>
          <div class="form-group">
            <label class="form-label">Total price</label>
            <p class="form-text">₹{{ bookingForm.get('totalPrice')?.value }}</p>
          </div>
        </div>
        </div>
        <div class="d-flex justify-content-end mt-3" style="padding: 1rem;">
          <button 
          type="button" 
          class="btn btn-success" 
          (click)="nextStep()"
          [disabled]="bookingForm.invalid"
          [ngClass]="{ 'disabled-button': bookingForm.invalid }"
          >
          Next
          </button>
        </div>
        
      </form>
    </div>
    <div *ngSwitchCase="2">
      <!-- Customer Form Content -->
      <!-- <div *ngIf="showButtons" class="customer">
        <button class="btn btn-info" (click)="newCustomer()">New customer</button>
        <button class="btn btn-info" (click)="existingCustomer()">Existing customer</button>
      </div> -->
      <div *ngIf="showButtons && inCustomerSelectionStep" class="customer">
        <button class="btn btn-info" (click)="newCustomer()">New customer</button>
        <button class="btn btn-info" (click)="existingCustomer()">Existing customer</button>
      </div>
      
      <!-- <div class="row" *ngIf="this.showCustomerIdInput && isExistingCustomer">
        <div class="col-9">
          <input type="number" #customerIdInput placeholder="Enter Customer ID" class="form-control">
        </div>
        <div class="col-3 search-btn">
          <button type="button" class="btn btn-primary" (click)="searchCustomer(customerIdInput)">Search</button>
        </div>
      </div> -->
      
    

      <div  class="row" *ngIf="showCustomerIdInput && isExistingCustomer">
        <!-- <label for="customerSearch">Search by Customer Name:</label> -->
        <div class="col-9">
          <input 
            type="text" 
            id="customerSearch" 
            (input)="searchCustomerByName($event)" 
            class="form-control" 
            placeholder="Enter Customer Name"
          >
          
        </div>
        <div class="col-3 search-btn">
          <button 
            type="button" 
            class="btn btn-primary" 
            (click)="searchCustomerByNameOnClick()">Search
          </button>
        </div>
        <!-- Display the list of matching customers (max 5) -->
        <div *ngIf="filteredCustomers.length > 0" class="customer-list">
          <ul>
            <li 
              *ngFor="let customer of filteredCustomers" 
              (click)="selectCustomer(customer)"
              (mouseover)="hoveredCustomer = customer"
              [class.hover]="hoveredCustomer === customer"
            >
            
              <div>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16px" height="16px" style="margin-right: 8px;">
                  <path d="M12 12c2.66 0 4.8-2.14 4.8-4.8S14.66 2.4 12 2.4 7.2 4.54 7.2 7.2 9.34 12 12 12zM12 14.4c-3.06 0-9 1.54-9 4.6v1.8c0 .22.18.4.4.4h17.2c.22 0 .4-.18.4-.4V19c0-3.06-5.94-4.6-9-4.6z"/>
                </svg>
                 {{ customer.firstName }} {{ customer.middleName }} {{ customer.lastName }}
                  <!-- Age: {{ customer.age }} Address: {{ customer.address }} ID: {{ customer.customerId }} -->
              </div>
            </li>
          </ul>
        </div>
        <div *ngIf="noResultsMessage" class="text-danger mt-2">
          {{ noResultsMessage }}
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="previousStep()">Previous</button>
          <button type="button" class="btn btn-success" (click)="nextStep()">Next</button>
        </div>
      </div>


      
      <div *ngIf="errorMessage" class="alert alert-danger mt-2">
        {{ errorMessage }}
      </div>
       <!-- <input type="number" #customerIdInput placeholder="Enter Customer ID" class="form-control mt-2"> -->
       <div *ngIf="showCustomerForm">
          <form [formGroup]="customerForm">
            <!-- Customer Form Fields -->
            <!-- <div class="row mb-3">
              <div class="col-12">
                <label for="customerId" class="form-label">Customer ID</label>
                <p class="form-text">{{ customerForm.get('customerId')?.value }}</p>
              </div>
            </div> -->
            <div class="row mb-3">
              <div class="col-md-4">
                <label for="firstName" class="form-label">First Name</label>
                <input type="text" id="firstName" class="form-control" formControlName="firstName">
              </div>
              <div class="col-md-4">
                <label for="middleName" class="form-label">Middle Name</label>
                <input type="text" id="middleName" class="form-control" formControlName="middleName">
              </div>
              <div class="col-md-4">
                <label for="lastName" class="form-label">Last Name</label>
                <input type="text" id="lastName" class="form-control" formControlName="lastName">
              </div>
              <div *ngIf="customerForm.get('firstName')?.touched || customerForm.get('firstName')?.dirty">
                <small *ngIf="customerForm.get('firstName')?.hasError('required')" class="text-danger">First name is required.</small>
                <small *ngIf="customerForm.get('firstName')?.hasError('minlength')" class="text-danger">First name must be at least 2 characters long.</small>
              </div>
              <div *ngIf="customerForm.get('middleName')?.invalid">
                <small *ngIf="customerForm.get('middleName')?.errors" class="text-danger">Middle name must have alhpabets only.</small>
              </div>
              <div *ngIf="customerForm.get('lastName')?.invalid">
                <small *ngIf="customerForm.get('lastName')?.errors" class="text-danger">Last name must have alhpabets only.</small>
              </div>
            </div>
            <div class="row mb-3" *ngIf="!isExistingCustomer">
              <div class="col-md-5">
                <label for="birthDate" class="form-label">Birth Date</label>
                <input type="date" id="birthDate" class="form-control" formControlName="birthDate" (change)="onBirthDateChange()" [max]="DOB">
                <div *ngIf="customerForm.get('birthDate')?.invalid && customerForm.get('birthDate')?.touched">
                  <small *ngIf="customerForm.get('birthDate')?.errors" class="text-danger">Birth Date is required.</small>
                </div>
              </div>
              <div class="col-md-2">
                <label for="age" class="form-label">Age</label>
                <input type="number" id="age" class="form-control" formControlName="age" [disabled]="true" >
                <div *ngIf="customerForm.get('age')?.invalid">
                  <small *ngIf="customerForm.get('age')?.errors?.['min']" class="text-danger">Age must be greater than 0.</small>
                </div>
              </div>
              <div class="col-md-5">
                <label for="mobileNumber" class="form-label">Mobile Number</label>
                <input 
                  type="text" 
                  id="mobileNumber" 
                  class="form-control" 
                  formControlName="mobileNumber"
                >
                <div *ngIf="customerForm.get('mobileNumber')?.touched">
                  <div *ngIf="customerForm.get('mobileNumber')?.hasError('required')">
                    <small class="text-danger">Mobile Number is required.</small>
                  </div>
                  <div *ngIf="customerForm.get('mobileNumber')?.hasError('pattern')">
                    <small class="text-danger">
                      Mobile Number must be exactly 10 digits.
                    </small>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-4">
                <label for="address" class="form-label">Address</label>
                <input type="text" id="address" class="form-control" formControlName="address">
                <div *ngIf="customerForm.get('address')?.invalid && customerForm.get('address')?.touched">
                  <small *ngIf="customerForm.get('address')?.errors" class="text-danger">Address is required.</small>
                </div>
              </div>
              <div class="col-md-4">
                <label for="district" class="form-label">District</label>
                <input type="text" id="district" class="form-control" formControlName="district">
                <div *ngIf="customerForm.get('district')?.invalid && customerForm.get('district')?.touched">
                  <small *ngIf="customerForm.get('district')?.errors" class="text-danger">District is required.</small>
                </div>
              </div>
              <div class="col-md-4">
                <label for="pincode" class="form-label">Pincode</label>
                <input type="text" id="pincode" class="form-control" formControlName="pincode" maxlength="6" >
                <div *ngIf="customerForm.get('pincode')?.touched">
                  <div *ngIf="customerForm.get('pincode')?.hasError('required')">
                    <small class="text-danger">Pincode is required.</small>
                  </div>
                  <div *ngIf="customerForm.get('pincode')?.hasError('pattern')">
                    <small class="text-danger">Pincode must be 6 digits.</small>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-4">
                <label for="city" class="form-label">City</label>
                <input type="text" id="city" class="form-control" formControlName="city">
                <div *ngIf="customerForm.get('city')?.invalid && customerForm.get('city')?.touched">
                  <small *ngIf="customerForm.get('city')?.errors" class="text-danger">City is required.</small>
                </div>
              </div>
              <div class="col-md-4">
                <label for="state" class="form-label">State</label>
                <input type="text" id="state" class="form-control" formControlName="state">
                <div *ngIf="customerForm.get('state')?.invalid && customerForm.get('state')?.touched">
                  <small *ngIf="customerForm.get('state')?.errors" class="text-danger">State is required.</small>
                </div>
              </div>
              <div class="col-md-4">
                <label for="country" class="form-label">Country</label>
                <input type="text" id="country" class="form-control" formControlName="country">
                <div *ngIf="customerForm.get('country')?.invalid && customerForm.get('country')?.touched">
                  <small *ngIf="customerForm.get('country')?.errors" class="text-danger">Country is required.</small>
                </div>
              </div>
              
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" (click)="previousStep()">Previous</button>
            <button type="button" class="btn btn-success" (click)="nextStep()">Next</button>
            </div>
          </form>
        </div>
        <div class="modal-footer" *ngIf="inCustomerSelectionStep && !showCustomerForm && !showCustomerIdInput">
          <button type="button" class="btn btn-primary" (click)="previousStep()">Previous</button>
        </div>
    </div>
    <div *ngSwitchCase="3">
      <form [formGroup]="paymentForm">
        <div class="mb-3">
          <label for="paymentId" class="form-label">Payment ID</label>
          <input type="text" id="paymentId" class="form-control" formControlName="paymentId" readonly>
        </div>
        <div class="mb-3">
          <label for="paymentMode" class="form-label">Payment Mode</label>
          <select id="paymentMode" class="form-select" formControlName="paymentMode" (change)="onPaymentModeChange($event)">
            <option value="Cash">Cash</option>
              <option value="creditCard">Credit Card</option>
              <option value="debitCard">Debit Card</option>
              <option value="netBanking">Net Banking</option>
              <option value="upi">UPI</option>
          </select>
        </div>

        <div *ngIf="isCardPayment()">
          <div class="mb-3">
            <label for="cardNumber" class="form-label">Card Number</label>
            <input type="text" id="cardNumber" class="form-control" formControlName="cardNumber">
          </div>
          <div class="mb-3">
            <label for="cardHolderName" class="form-label">Card Holder Name</label>
            <input type="text" id="cardHolderName" class="form-control" formControlName="cardHolderName">
          </div>
          <div class="mb-3">
            <label for="expiryDate" class="form-label">Expiry Date</label>
            <input type="text" id="expiryDate" class="form-control" formControlName="expiryDate" placeholder="MM/YY">
          </div>
          <div class="mb-3">
            <label for="cvv" class="form-label">CVV</label>
            <input type="text" id="cvv" class="form-control" formControlName="cvv">
          </div>
        </div>
    
        <!-- Net Banking Inputs -->
        <div *ngIf="isNetBanking()">
          <div class="mb-3">
            <label for="bankName" class="form-label">Bank Name</label>
            <input type="text" id="bankName" class="form-control" formControlName="bankName">
          </div>
          <div class="mb-3">
            <label for="accountNumber" class="form-label">Account Number</label>
            <input type="text" id="accountNumber" class="form-control" formControlName="accountNumber">
          </div>
        </div>

        <div *ngIf="isUPI()">
          <div class="mb-3">
            <label for="upi" class="form-label">UPI</label>
            <input type="text" id="upi" class="form-control" formControlName="upi">
          </div>
         
        </div>

        <div class="mb-3">
          <label for="totalAmount" class="form-label">Total Amount</label>
          <input type="text" id="totalAmount" class="form-control" formControlName="totalAmount" readonly>
        </div>
        <div class="mb-3">
          <label for="paidAmount" class="form-label">Paid Amount</label>
          <input type="number" id="paidAmount" class="form-control" formControlName="paidAmount" (input)="updateDueAmount()">
          <div *ngIf="paymentForm.get('paidAmount')?.touched">
            <div *ngIf="paymentForm.get('paidAmount')?.hasError('required')">
              <small class="text-danger">Paid Amount is required.</small>
            </div>
            <div *ngIf="paymentForm.get('paidAmount')?.hasError('negative')">
              <small class="text-danger">Paid Amount cannot be negative.</small>
            </div>
            <div *ngIf="paymentForm.get('paidAmount')?.hasError('exceedTotal')">
              <small class="text-danger">Paid Amount cannot exceed the total amount.</small>
            </div>
          </div>
          
        </div>
        <div class="mb-3">
          <label for="dueAmount" class="form-label">Due Amount</label>
          <input type="text" id="dueAmount" class="form-control" formControlName="dueAmount" readonly>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="previousStep()">Previous</button>
          <button type="button" class="btn btn-success" (click)="nextStep()">Submit</button>
        </div>
        
      </form>
    </div>
    <div *ngSwitchCase="4">
      <!-- Confirmation Message -->
      <div class="final-page text-center">
        <h3 style="color:darkcyan;">Your booking details have been successfully submitted.</h3>
    
        <!-- Booking Information Section -->
        <div class="invoice-section">
          <h4>Booking Information</h4>
          <table class="table table-bordered">
            <tbody>
              <tr>
                <th>Reservation ID</th>
                <td>{{ bookingForm.value.reservationId }}</td>
              </tr>
              <tr>
                <th>Room No</th>
                <td>{{ bookingForm.value.roomNo }}</td>
              </tr>
              <tr>
                <th>Stay From</th>
                <td>{{ bookingForm.value.stayDateFrom | date }}</td>
              </tr>
              <tr>
                <th>Stay To</th>
                <td>{{ bookingForm.value.stayDateTo | date }}</td>
              </tr>
              <tr>
                <th>Number of nights</th>
                <td>{{ bookingForm.value.numberOfDays }}</td>
              </tr>
              <tr>
                <th>Total Guests</th>
                <td>{{ bookingForm.value.totalNumberOfGuests }}</td>
              </tr>
              <!-- <tr>
                <th>Total Price</th>
                <td>₹{{ bookingForm.value.totalPrice }}</td>
              </tr> -->
            </tbody>
          </table>
        </div>
    
        <!-- Customer Information Section -->
        <div class="invoice-section">
          <h4>Customer Information</h4>
          <table class="table table-bordered">
            <tbody>
              <!-- <tr>
                <th>Customer ID</th>
                <td>{{ customerForm.value.customerId }}</td>
              </tr> -->
              <tr>
                <th>Name</th>
                <td>{{ customerForm.value.firstName }} {{ customerForm.value.middleName ? customerForm.value.middleName : '' }} {{ customerForm.value.lastName }}</td>
              </tr>
              <tr>
                <th>Address</th>
                <td>{{ customerForm.value.address }}</td>
              </tr>
              <tr>
                <th>Pincode</th>
                <td>{{ customerForm.value.pincode }}</td>
              </tr>
              <tr>
                <th>State</th>
                <td>{{ customerForm.value.state }}</td>
              </tr>
              <tr>
                <th>Country</th>
                <td>{{ customerForm.value.country }}</td>
              </tr>
            </tbody>
          </table>
        </div>
    
        <!-- Payment Information Section -->
        <div class="invoice-section">
          <h4>Payment Information</h4>
          <table class="table table-bordered">
            <tbody>
              <tr>
                <th>Total Amount</th>
                <td>₹{{ paymentForm.value.totalAmount }}</td>
              </tr>
              <tr>
                <th>Paid Amount</th>
                <td>₹{{ paymentForm.value.paidAmount }}</td>
              </tr>
              <tr>
                <th>Due Amount</th>
                <td>₹{{ paymentForm.value.dueAmount }}</td>
              </tr>
            </tbody>
          </table>
        </div>
    
        <div class="invoice-footer">
          Thank you for your booking!
        </div>
      </div>
    
      <!-- Buttons for further action -->
      <div class="d-flex justify-content-end" style="padding: 1rem;">
        <button type="button" class="btn btn-success me-2" (click)="downloadInvoicePDF()">Download Invoice</button>
        <button type="button" class="btn btn-secondary" (click)="resetForms()" (click)="redirectToChart()">Go to Planning chart</button>
      </div>
    </div>
    
  </ng-container>
</div>